library(tidyverse)
library(readxl)
library(reshape2)
library(plotly)
options(scipen=999) #Do not display numbers in scientific notation
##Database from OurWorld In data website
cov<-read_csv("https://covid.ourworldindata.org/data/owid-covid-data.csv")

#Exploratory time series for new cases and new deaths daily in some countries
countries<-list("Brazil","United States","India","United Kingdom", "Spain", 
                  "Italy","Canada","Japan","Germany","Australia","France","Mexico")

  i=1
  a<-list()
  for (i in 1:length(countries)){
    a[[i]]<-cov%>%
      filter(location==countries[i] & new_deaths>0)%>%select(date,new_deaths,new_cases)%>%
      gather(key = "Feature",value = "Qty",-date)%>%
      ggplot(aes(x=date,y=Qty))+geom_line()+facet_grid(Feature~.,scales = "free_y")+ggtitle(countries[[i]])
print(ggplotly(a[[i]]))
  }  

#Explorotary analysis over vaccination and new deaths
for (i in 1:length(countries)){
  b[[i]]<-cov%>%
    filter(location==countries[i] & new_deaths>0)%>%
    select(date,new_deaths,people_fully_vaccinated_per_hundred)%>%
    ggplot(aes(x=date))+geom_line(aes(y=new_deaths),size=1,color="#69b3a2")+
    geom_line(aes(y=people_fully_vaccinated_per_hundred*100),size=1,color="gray39")+
    scale_y_continuous(name="New daily Deaths",
                       sec.axis = sec_axis(~./100,name = "People Fully Vacc (%)"))+
    ggtitle(countries[[i]])
print(b[[i]])
  }


